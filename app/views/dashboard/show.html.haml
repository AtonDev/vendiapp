.container-fluid
	.row
		.col-lg-10.col-lg-offset-1
			%h1.page-header Dashboard
	.row
		.col-lg-10.col-lg-offset-1
			%h2.sub-header Messages
			.table-responsive
				%table.table.table-striped
					%thead
						%tr
							%th Date 
							%th Content
							%th
					%tbody
						-@notifications.each do |msg|
							%tr
								%td 
									=msg.created_at
								%td 
									=msg.content
								%td 
									=form_tag(:dismiss_message, :method => :get) do
										=hidden_field_tag "msg[id]", msg.id
										=submit_tag decode_entity("&times;"), :class => "close-btn", "aria-hidden" => "true"
			%ul.pagination.pagination-sm
				=will_paginate @notifications, :param_name => "notifications_page", container: false 
						
			
	.row
		.col-lg-10.col-lg-offset-1
			%h2.sub-header Your items
			%ul.nav.nav-tabs
				%li.active
					%a{"data-toggle" => "tab", href: "#selling"} Currently Selling
				%li
					%a{"data-toggle" => "tab", href: "#pending"} Pending Proposal
			.tab-content
				#selling.tab-pane.active 
					.table-responsive
						%table.table.table-striped.table-hover
							%thead
								%tr
									%th Date due
									%th Title
									%th Price
									%th Description

								%tbody
									-@selling_items.each_with_index do |item, idx|
										%tr{"onclick"=>"$('#sellingModal#{idx}').modal();"}
											%td 
												=item.sale_info.start_sale
											%td 
												=item.title
											%td 
												=item.sale_info.proposed_price
											%td 
												=item.description
										
					%ul.pagination.pagination-sm
						=will_paginate @selling_items, :param_name => "selling_page",  container: false 
					
				#pending.tab-pane 
					.table-responsive
						%table.table.table-striped.table-hover
							%thead
								%tr
									%th Proposal Date
									%th Title
									%th Vendi-bid
									%th Description

								%tbody
									-@pending_proposals.each_with_index do |proposal,idx|
										-item = proposal.item
										%tr{"onclick"=>"$('#pendingModal#{idx}').modal();"}
											%td 
												=proposal.created_at
											%td 
												=item.title
											%td 
												=proposal.price
											%td 
												=item.description

					%ul.pagination.pagination-sm
						=will_paginate @pending_proposals, :param_name => "pending_page", container: false 
	.row
		.col-lg-10.col-lg-offset-1
			%h2.sub-header Sneak Peek
			.table-responsive
				%table.table.table-hover.table-striped
					%thead
						%tr
							%th Thumb
							%th Title
							%th Description

						%tbody
							-@ledger_items.each_with_index do |item, idx|
								%tr{"onclick"=>"$('#sneakPeekModal#{idx}').modal('toggle');", "data-target" => "bs.modal"}
									%td 
										=image_tag item.images.first.photo.url(:thumb), :class => "img-rounded"
									%td 
										=item.title
									%td 
										=item.description


-#--------------------------------------MODALS---------------------------------
-@selling_items.each_with_index do |item, idx|
	-#------------------------------Modal for selling --------------------
	.modal.fade{:id => "sellingModal#{idx}","aria-hidden" => "true", "aria-labelledby" => "myModalLabel", :role => "dialog", :tabindex => "-1"}
		.modal-dialog.modal-lg
			.modal-content
				.modal-header
					%button.close{"aria-hidden" => "true", "data-dismiss" => "modal", :type => "button"} &times;
					%h4#myModalLabel.modal-title 
						=item.title
				.modal-body
					.row
						.col-md-10.col-md-offset-1
							.item-details
								%h4 Description
								%p
									= item.description
								%hr
								%h4 Images
								-item.images.each do |img|
									.col-md-4
										=image_tag img.photo.url(:square), :class => "img-rounded", :style => "margin-top:10px; margin-bottom:20px;"
								
								%h4 Price
								%p Please submit the price at which you believe youcan sell this item for after fees. There are other sellers that are going to submit a price for this item. When 2 days pass from the first price submission, we are going to give the right to sell the item to the higher bidder.
								%p If you are the higher bidder you have the right to sell the item for week. If you do so, you are responsible to submit to vendi 90% of the price you intially proposed, for the item to be shipped. 
								%p The more items you sell, the higher you will get. If you have a high score, you will access more to premium items (ie items coming from reliable owners that have high value)
								%hr
								=form_tag(:item_sold, :method => :get) do 
									=hidden_field_tag :id, item.id
									=submit_tag "Sold!", :class => "center-block btn-lg btn-primary"

				.modal-footer
					%button.btn.btn-default{"data-dismiss" => "modal", :type => "button"} Close
					%button.btn.btn-primary{:type => "button"} Save changes
-#------------------end of modal for curently-------------------------------


-@pending_proposals.each_with_index do |proposal,idx|
	-item = proposal.item
	-#------------------------------Modal for pending --------------------
	.modal.fade{:id => "pendingModal#{idx}", "aria-hidden" => "true", "aria-labelledby" => "myModalLabel", :role => "dialog", :tabindex => "-1"}
		.modal-dialog.modal-lg
			.modal-content
				.modal-header
					%button.close{"aria-hidden" => "true", "data-dismiss" => "modal", :type => "button"} &times;
					%h4#myModalLabel.modal-title 
						=item.title
				.modal-body
					.row
						.col-md-10.col-md-offset-1
							.item-details
								%h4 Description
								%p
									= item.description
								%hr
								%h4 Images
								-item.images.each do |img|
									.col-md-4
										=image_tag img.photo.url(:square), :class => "img-rounded", :style => "margin-top:10px; margin-bottom:20px;"
								
								%h4 Price
								%p Please submit the price at which you believe youcan sell this item for after fees. There are other sellers that are going to submit a price for this item. When 2 days pass from the first price submission, we are going to give the right to sell the item to the higher bidder.
								%p If you are the higher bidder you have the right to sell the item for week. If you do so, you are responsible to submit to vendi 90% of the price you intially proposed, for the item to be shipped. 
								%p The more items you sell, the higher you will get. If you have a high score, you will access more to premium items (ie items coming from reliable owners that have high value)
								%hr
								%p Waiting for proposal response.

				.modal-footer
					%button.btn.btn-default{"data-dismiss" => "modal", :type => "button"} Close
					%button.btn.btn-primary{:type => "button"} Save changes
	-#------------------end of modal for penging-------------------------------
								
-@ledger_items.each_with_index do |item, idx|
	-#----------------------------------------Modal for sneak peek------------------------
	.modal.fade{:id => "sneakPeekModal#{idx}", "aria-hidden" => "true", "aria-labelledby" => "myModalLabel", :role => "dialog", :tabindex => "-1"}
		.modal-dialog.modal-lg
			.modal-content
				.modal-header
					%button.close{"aria-hidden" => "true", "data-dismiss" => "modal", :type => "button"} &times;
					%h4#myModalLabel.modal-title 
						=item.title
				.modal-body
					.row
						.col-md-10.col-md-offset-1
							.item-details
								%h4 Description
								%p
									= item.description
								%hr
								%h4 Images
								-item.images.each do |img|
									.col-md-4
										=image_tag img.photo.url(:square), :class => "img-rounded", :style => "margin-top:10px; margin-bottom:20px;"
								
								%h4 Price
								%p Please submit the price at which you believe youcan sell this item for after fees. There are other sellers that are going to submit a price for this item. When 2 days pass from the first price submission, we are going to give the right to sell the item to the higher bidder.
								%p If you are the higher bidder you have the right to sell the item for week. If you do so, you are responsible to submit to vendi 90% of the price you intially proposed, for the item to be shipped. 
								%p The more items you sell, the higher you will get. If you have a high score, you will access more to premium items (ie items coming from reliable owners that have high value)
								%hr
								=form_tag(:new_price_proposal, :method => :get) do
									=hidden_field_tag "proposal[item_id]", item.id
									.form-group
										.col-sm-1
											=label_tag :price, "Price:", :class => "control-label"
										.col-sm-3
											=number_field_tag "proposal[price]", nil, :class => "form-control", :placeholder => "USD"
									.col-sm-8
										=submit_tag :submit, :class => "btn btn-primary"

				.modal-footer
					%button.btn.btn-default{"data-dismiss" => "modal", :type => "button"} Close
					%button.btn.btn-primary{:type => "button"} Save changes
	-#------------------end of modal for sneak peek-------------------------------


:javascript
	$('body').on('hidden.bs.modal', '.modal', function () {
		$(this).removeData('bs.modal');
	});

























